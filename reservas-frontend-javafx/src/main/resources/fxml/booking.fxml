<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.control.TextField?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.RowConstraints?>

<!--
  Vista de Reservas Unificada
  Sistema de Reservas - Municipalidad de Pérez Zeledón
  
  Contiene:
  - Formulario Nueva Reserva (vboxBookingForm)
  - Detalles de Espacio (vboxSpaceDetails)
  
  Se controlan con visible="true/false" desde BookingController
-->

<BorderPane fx:id="rootPane" prefWidth="1440.0" prefHeight="900.0" 
            styleClass="border-pane-root"
            stylesheets="@../styles.css"
            xmlns="http://javafx.com/javafx/21" 
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="cr.una.reservas.frontend.controllers.BookingController">
    
    <!-- ============================================
         NAVBAR
         ============================================ -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="16.0" prefHeight="72.0" styleClass="navbar">
            <Button text="←" styleClass="button-icon" onAction="#handleBack"/>
            <Label fx:id="navbarTitle" text="Nueva Reserva" styleClass="navbar-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button text="❓ Ayuda" styleClass="button-text"/>
            <padding>
                <Insets left="24.0" right="24.0"/>
            </padding>
        </HBox>
    </top>
    
    <!-- ============================================
         CONTENIDO CENTRAL - StackPane con 2 vistas
         ============================================ -->
    <center>
        <StackPane>
            
            <!-- ============================================
                 VISTA 1: FORMULARIO DE NUEVA RESERVA
                 ============================================ -->
            <VBox fx:id="vboxBookingForm" spacing="24.0" visible="true">
                <ScrollPane fitToWidth="true" styleClass="scroll-pane-content" VBox.vgrow="ALWAYS">
                    <VBox spacing="24.0" alignment="TOP_CENTER">
                        
                        <!-- Contenedor centrado -->
                        <VBox spacing="24.0" maxWidth="800.0">
                            
                            <!-- Header -->
                            <VBox spacing="8.0" styleClass="content-header">
                                <Label text="Nueva Reserva" styleClass="page-title"/>
                                <Label text="Completa el formulario para reservar este espacio" 
                                      styleClass="page-subtitle"/>
                            </VBox>
                            
                            <!-- Información del Espacio Seleccionado -->
                            <VBox spacing="16.0" styleClass="section-card">
                                <Label text="Espacio Seleccionado" styleClass="section-title"/>
                                
                                <HBox spacing="16.0" alignment="CENTER_LEFT">
                                    <ImageView fx:id="spaceImage" fitWidth="120.0" fitHeight="120.0" 
                                             preserveRatio="true" styleClass="space-image"/>
                                    <VBox spacing="8.0" VBox.vgrow="ALWAYS">
                                        <Label fx:id="spaceName" text="Nombre del Espacio" 
                                              styleClass="form-label-large"/>
                                        <Label fx:id="spaceType" text="Tipo" styleClass="text-secondary"/>
                                        <HBox spacing="16.0">
                                            <Label fx:id="spaceCapacity" text="👥 Capacidad: 50" 
                                                  styleClass="text-secondary"/>
                                            <Label fx:id="spaceLocation" text="📍 Ubicación" 
                                                  styleClass="text-secondary"/>
                                        </HBox>
                                        <Button text="Ver Detalles Completos →" styleClass="button-text" 
                                               onAction="#showSpaceDetails"/>
                                    </VBox>
                                </HBox>
                            </VBox>
                            
                            <!-- Formulario -->
                            <VBox spacing="24.0" styleClass="section-card">
                                <Label text="Información de la Reserva" styleClass="section-title"/>
                                
                                <GridPane hgap="16.0" vgap="16.0">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="50.0"/>
                                        <ColumnConstraints percentWidth="50.0"/>
                                    </columnConstraints>
                                    
                                    <!-- Fila 1: Fecha -->
                                    <VBox spacing="8.0" GridPane.columnIndex="0" GridPane.rowIndex="0">
                                        <Label text="Fecha *" styleClass="form-label"/>
                                        <DatePicker fx:id="bookingDate" promptText="Seleccione fecha" 
                                                   styleClass="date-picker" maxWidth="Infinity"/>
                                    </VBox>
                                    
                                    <VBox spacing="8.0" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                        <Label text="Duración *" styleClass="form-label"/>
                                        <ComboBox fx:id="durationCombo" promptText="Seleccione duración" 
                                                 styleClass="combo-box" maxWidth="Infinity"/>
                                    </VBox>
                                    
                                    <!-- Fila 2: Hora -->
                                    <VBox spacing="8.0" GridPane.columnIndex="0" GridPane.rowIndex="1">
                                        <Label text="Hora Inicio *" styleClass="form-label"/>
                                        <ComboBox fx:id="startTimeCombo" promptText="HH:MM" 
                                                 styleClass="combo-box" maxWidth="Infinity"/>
                                    </VBox>
                                    
                                    <VBox spacing="8.0" GridPane.columnIndex="1" GridPane.rowIndex="1">
                                        <Label text="Hora Fin *" styleClass="form-label"/>
                                        <ComboBox fx:id="endTimeCombo" promptText="HH:MM" 
                                                 styleClass="combo-box" maxWidth="Infinity" disable="true"/>
                                    </VBox>
                                    
                                    <!-- Fila 3: Asistentes -->
                                    <VBox spacing="8.0" GridPane.columnIndex="0" GridPane.rowIndex="2">
                                        <Label text="Número de Asistentes *" styleClass="form-label"/>
                                        <TextField fx:id="attendeesField" promptText="Ej: 25" 
                                                  styleClass="text-field"/>
                                    </VBox>
                                    
                                    <VBox spacing="8.0" GridPane.columnIndex="1" GridPane.rowIndex="2">
                                        <Label text="Tipo de Evento" styleClass="form-label"/>
                                        <ComboBox fx:id="eventTypeCombo" promptText="Seleccione tipo" 
                                                 styleClass="combo-box" maxWidth="Infinity"/>
                                    </VBox>
                                    
                                    <!-- Fila 4: Descripción -->
                                    <VBox spacing="8.0" GridPane.columnIndex="0" GridPane.rowIndex="3" 
                                         GridPane.columnSpan="2">
                                        <Label text="Descripción del Evento" styleClass="form-label"/>
                                        <TextArea fx:id="descriptionArea" promptText="Describa el propósito de la reserva..." 
                                                 styleClass="text-area" prefRowCount="4"/>
                                    </VBox>
                                    
                                    <!-- Fila 5: Contacto -->
                                    <VBox spacing="8.0" GridPane.columnIndex="0" GridPane.rowIndex="4">
                                        <Label text="Teléfono de Contacto *" styleClass="form-label"/>
                                        <TextField fx:id="phoneField" promptText="8888-8888" 
                                                  styleClass="text-field"/>
                                    </VBox>
                                    
                                    <VBox spacing="8.0" GridPane.columnIndex="1" GridPane.rowIndex="4">
                                        <Label text="Email de Confirmación" styleClass="form-label"/>
                                        <TextField fx:id="emailField" promptText="usuario@email.com" 
                                                  styleClass="text-field"/>
                                    </VBox>
                                </GridPane>
                            </VBox>
                            
                            <!-- Resumen del Costo -->
                            <VBox spacing="16.0" styleClass="section-card, highlight-card">
                                <Label text="Resumen de Costo" styleClass="section-title"/>
                                
                                <GridPane hgap="16.0" vgap="12.0">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="70.0"/>
                                        <ColumnConstraints percentWidth="30.0" halignment="RIGHT"/>
                                    </columnConstraints>
                                    
                                    <Label text="Tarifa por hora" styleClass="text-secondary" 
                                          GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                    <Label fx:id="hourlyRateLabel" text="₡5,000" styleClass="text-secondary" 
                                          GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                                    
                                    <Label text="Duración" styleClass="text-secondary" 
                                          GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                    <Label fx:id="durationLabel" text="2 horas" styleClass="text-secondary" 
                                          GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                                    
                                    <Separator GridPane.columnIndex="0" GridPane.rowIndex="2" GridPane.columnSpan="2"/>
                                    
                                    <Label text="Total" styleClass="form-label-large" 
                                          GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                                    <Label fx:id="totalCostLabel" text="₡10,000" styleClass="form-label-large" 
                                          GridPane.columnIndex="1" GridPane.rowIndex="3"/>
                                </GridPane>
                            </VBox>
                            
                            <!-- Términos y Condiciones -->
                            <HBox spacing="8.0" alignment="CENTER_LEFT" styleClass="checkbox-container">
                                <Label text="☐ Acepto los términos y condiciones" styleClass="text-secondary"/>
                                <Button text="Ver términos" styleClass="button-text"/>
                            </HBox>
                            
                            <!-- Botones de Acción -->
                            <HBox spacing="16.0" alignment="CENTER">
                                <Button text="Cancelar" styleClass="button-secondary" 
                                       onAction="#handleCancel" prefWidth="150.0"/>
                                <Button text="Confirmar Reserva" styleClass="button-primary" 
                                       onAction="#handleConfirmBooking" prefWidth="200.0"/>
                            </HBox>
                            
                        </VBox>
                        
                        <padding>
                            <Insets top="24.0" bottom="24.0" left="24.0" right="24.0"/>
                        </padding>
                    </VBox>
                </ScrollPane>
            </VBox>
            
            <!-- ============================================
                 VISTA 2: DETALLES DE ESPACIO
                 ============================================ -->
            <VBox fx:id="vboxSpaceDetails" spacing="24.0" visible="false">
                <ScrollPane fitToWidth="true" styleClass="scroll-pane-content" VBox.vgrow="ALWAYS">
                    <VBox spacing="24.0">
                        
                        <!-- Header con Imagen Grande -->
                        <VBox spacing="0.0">
                            <ImageView fx:id="spaceDetailImage" fitWidth="1440.0" fitHeight="400.0" 
                                     preserveRatio="false" styleClass="space-hero-image"/>
                        </VBox>
                        
                        <!-- Contenido centrado -->
                        <VBox spacing="24.0" maxWidth="1000.0" alignment="TOP_CENTER">
                            
                            <!-- Título y CTA -->
                            <HBox spacing="24.0" alignment="CENTER_LEFT">
                                <VBox spacing="8.0" HBox.hgrow="ALWAYS">
                                    <Label fx:id="spaceDetailName" text="Nombre del Espacio" 
                                          styleClass="page-title"/>
                                    <HBox spacing="16.0">
                                        <Label fx:id="spaceDetailType" text="📋 Tipo" styleClass="text-secondary"/>
                                        <Label fx:id="spaceDetailCapacity" text="👥 Capacidad" styleClass="text-secondary"/>
                                        <Label fx:id="spaceDetailLocation" text="📍 Ubicación" styleClass="text-secondary"/>
                                    </HBox>
                                </VBox>
                                <Button text="Reservar Ahora →" styleClass="button-primary" 
                                       onAction="#handleBookNow" prefWidth="180.0" prefHeight="50.0"/>
                            </HBox>
                            
                            <!-- Descripción -->
                            <VBox spacing="16.0" styleClass="section-card">
                                <Label text="Descripción" styleClass="section-title"/>
                                <Label fx:id="spaceDetailDescription" wrapText="true" 
                                      text="Descripción completa del espacio..." 
                                      styleClass="text-body"/>
                            </VBox>
                            
                            <!-- Características -->
                            <VBox spacing="16.0" styleClass="section-card">
                                <Label text="Características" styleClass="section-title"/>
                                <GridPane hgap="24.0" vgap="16.0">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="50.0"/>
                                        <ColumnConstraints percentWidth="50.0"/>
                                    </columnConstraints>
                                    <VBox fx:id="featuresContainer" spacing="12.0" 
                                         GridPane.columnIndex="0" GridPane.rowIndex="0" GridPane.columnSpan="2">
                                        <!-- Se llena dinámicamente -->
                                    </VBox>
                                </GridPane>
                            </VBox>
                            
                            <!-- Disponibilidad -->
                            <VBox spacing="16.0" styleClass="section-card">
                                <Label text="Disponibilidad" styleClass="section-title"/>
                                <VBox fx:id="availabilityCalendar" spacing="12.0">
                                    <!-- Calendario dinámico -->
                                </VBox>
                            </VBox>
                            
                            <!-- Tarifas -->
                            <VBox spacing="16.0" styleClass="section-card">
                                <Label text="Tarifas" styleClass="section-title"/>
                                <GridPane hgap="16.0" vgap="12.0">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="70.0"/>
                                        <ColumnConstraints percentWidth="30.0" halignment="RIGHT"/>
                                    </columnConstraints>
                                    
                                    <Label text="Tarifa por hora" styleClass="form-label" 
                                          GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                    <Label fx:id="hourlyRateDetail" text="₡5,000" styleClass="form-label" 
                                          GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                                    
                                    <Label text="Tarifa medio día (4 horas)" styleClass="text-secondary" 
                                          GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                    <Label fx:id="halfDayRateDetail" text="₡18,000" styleClass="text-secondary" 
                                          GridPane.columnIndex="1" GridPane.rowIndex="1"/>
                                    
                                    <Label text="Tarifa día completo (8 horas)" styleClass="text-secondary" 
                                          GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                                    <Label fx:id="fullDayRateDetail" text="₡35,000" styleClass="text-secondary" 
                                          GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                                </GridPane>
                            </VBox>
                            
                            <!-- Ubicación -->
                            <VBox spacing="16.0" styleClass="section-card">
                                <Label text="Ubicación" styleClass="section-title"/>
                                <Label fx:id="addressDetail" text="Dirección completa..." 
                                      styleClass="text-secondary"/>
                                <VBox fx:id="mapContainer" styleClass="map-container" 
                                     prefHeight="300.0">
                                    <!-- Mapa o imagen de ubicación -->
                                </VBox>
                            </VBox>
                            
                            <!-- CTA Final -->
                            <HBox spacing="16.0" alignment="CENTER">
                                <Button text="← Volver" styleClass="button-secondary" 
                                       onAction="#handleBack" prefWidth="150.0"/>
                                <Button text="Reservar Este Espacio →" styleClass="button-primary" 
                                       onAction="#handleBookNow" prefWidth="200.0"/>
                            </HBox>
                            
                        </VBox>
                        
                        <padding>
                            <Insets top="24.0" bottom="24.0" left="24.0" right="24.0"/>
                        </padding>
                    </VBox>
                </ScrollPane>
            </VBox>
            
        </StackPane>
    </center>
    
</BorderPane>
