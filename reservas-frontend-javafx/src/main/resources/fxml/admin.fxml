<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.DatePicker?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.MenuButton?>
<?import javafx.scene.control.MenuItem?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.Separator?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.StackPane?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.layout.ColumnConstraints?>

<!--
  Vista Administrativa Unificada
  Sistema de Reservas - Municipalidad de Pérez Zeledón
  
  Contiene:
  - Gestión de Espacios (vboxAdminSpaces)
  - Reportes (vboxAdminReports)
  
  Se controlan con visible="true/false" desde AdminController
-->

<BorderPane fx:id="rootPane" prefWidth="1440.0" prefHeight="900.0" 
            styleClass="border-pane-root"
            stylesheets="@../styles.css"
            xmlns="http://javafx.com/javafx/21" 
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="cr.una.reservas.frontend.controllers.AdminController">
    
    <!-- ============================================
         NAVBAR
         ============================================ -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="16.0" prefHeight="72.0" styleClass="navbar">
            <ImageView fx:id="navbarLogo" fitHeight="40.0" preserveRatio="true"/>
            <Label text="Panel Administrativo" styleClass="navbar-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button fx:id="notificationsButton" text="🔔" styleClass="button-icon"/>
            <MenuButton fx:id="userMenuButton" text="Administrador" styleClass="menu-button-user">
                <items>
                    <MenuItem text="Mi Perfil" onAction="#handleProfile"/>
                    <MenuItem text="Configuración" onAction="#handleSettings"/>
                    <MenuItem text="Cerrar Sesión" onAction="#handleLogout"/>
                </items>
            </MenuButton>
            <padding>
                <Insets left="24.0" right="24.0"/>
            </padding>
        </HBox>
    </top>
    
    <!-- ============================================
         SIDEBAR
         ============================================ -->
    <left>
        <VBox spacing="8.0" prefWidth="280.0" styleClass="sidebar">
            
            <!-- User Info -->
            <VBox alignment="CENTER" spacing="8.0" styleClass="sidebar-user-info">
                <ImageView fx:id="userAvatar" fitHeight="80.0" fitWidth="80.0" 
                          styleClass="user-avatar" preserveRatio="true"/>
                <Label fx:id="userNameLabel" text="Administrador" 
                      styleClass="sidebar-username"/>
                <Label text="Admin" styleClass="sidebar-user-role"/>
            </VBox>
            
            <Separator/>
            
            <!-- Navigation Buttons -->
            <VBox spacing="4.0" styleClass="sidebar-menu" VBox.vgrow="ALWAYS">
                <Button text="🏠  Dashboard" styleClass="sidebar-button"
                       onAction="#handleDashboard" maxWidth="Infinity"/>
                
                <Separator/>
                
                <Label text="Administración" styleClass="sidebar-section-title"/>
                
                <Button fx:id="adminSpacesNavButton" text="🔧  Gestión Espacios" 
                       styleClass="sidebar-button, sidebar-button-active"
                       onAction="#showAdminSpaces" maxWidth="Infinity"/>
                
                <Button fx:id="adminReportsNavButton" text="📊  Reportes" 
                       styleClass="sidebar-button"
                       onAction="#showAdminReports" maxWidth="Infinity"/>
                
                <Region VBox.vgrow="ALWAYS"/>
                
                <Separator/>
                
                <Button text="❓  Ayuda" styleClass="sidebar-button" maxWidth="Infinity"/>
                <Button text="⚙️  Configuración" styleClass="sidebar-button" maxWidth="Infinity"/>
            </VBox>
            
            <padding>
                <Insets top="24.0" bottom="24.0" left="16.0" right="16.0"/>
            </padding>
        </VBox>
    </left>
    
    <!-- ============================================
         CONTENIDO CENTRAL - StackPane con 2 vistas admin
         ============================================ -->
    <center>
        <StackPane>
            
            <!-- ============================================
                 VISTA 1: GESTIÓN DE ESPACIOS
                 ============================================ -->
            <VBox fx:id="vboxAdminSpaces" spacing="0" visible="true" styleClass="content-area">
                <ScrollPane fitToWidth="true" styleClass="scroll-pane-content" VBox.vgrow="ALWAYS">
                    <VBox spacing="32.0">
                        
                        <!-- Header -->
                        <VBox spacing="16.0">
                            <HBox alignment="CENTER_LEFT" spacing="16.0">
                                <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                    <Label text="Gestión de Espacios" styleClass="text-h2"/>
                                    <Label text="Administra los espacios municipales" styleClass="text-body, text-muted"/>
                                </VBox>
                                <Button text="➕ Nuevo Espacio" styleClass="button-primary" 
                                       onAction="#handleNewSpace"/>
                                <Button text="📥 Exportar" styleClass="button-secondary" 
                                       onAction="#handleExport"/>
                            </HBox>
                        </VBox>
                        
                        <!-- Stats Cards -->
                        <GridPane hgap="24.0" vgap="24.0">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="25.0"/>
                                <ColumnConstraints percentWidth="25.0"/>
                                <ColumnConstraints percentWidth="25.0"/>
                                <ColumnConstraints percentWidth="25.0"/>
                            </columnConstraints>
                            
                            <VBox spacing="8.0" styleClass="stat-card, stat-card-navy" GridPane.columnIndex="0" alignment="CENTER">
                                <Label text="Total Espacios" styleClass="stat-label"/>
                                <Label fx:id="totalSpacesCount" text="15" styleClass="stat-value"/>
                            </VBox>
                            
                            <VBox spacing="8.0" styleClass="stat-card, stat-card-navy" GridPane.columnIndex="1" alignment="CENTER">
                                <Label text="Activos" styleClass="stat-label"/>
                                <Label fx:id="activeSpacesCount" text="12" styleClass="stat-value"/>
                            </VBox>
                            
                            <VBox spacing="8.0" styleClass="stat-card, stat-card-navy" GridPane.columnIndex="2" alignment="CENTER">
                                <Label text="En Mantenimiento" styleClass="stat-label"/>
                                <Label fx:id="maintenanceSpacesCount" text="2" styleClass="stat-value"/>
                            </VBox>
                            
                            <VBox spacing="8.0" styleClass="stat-card, stat-card-navy" GridPane.columnIndex="3" alignment="CENTER">
                                <Label text="Ocupación" styleClass="stat-label"/>
                                <Label fx:id="occupancyRate" text="78%" styleClass="stat-value"/>
                            </VBox>
                        </GridPane>
                        
                        <!-- Tabla de Espacios -->
                        <VBox spacing="16.0" styleClass="card">
                            <Label text="Listado de Espacios" styleClass="text-h4"/>
                            
                            <TableView fx:id="spacesTable" styleClass="table-view">
                                <columns>
                                    <TableColumn fx:id="idColumn" text="ID" prefWidth="60.0"/>
                                    <TableColumn fx:id="nameColumn" text="Nombre" prefWidth="200.0"/>
                                    <TableColumn fx:id="typeColumn" text="Tipo" prefWidth="150.0"/>
                                    <TableColumn fx:id="capacityColumn" text="Capacidad" prefWidth="100.0"/>
                                    <TableColumn fx:id="statusColumn" text="Estado" prefWidth="120.0"/>
                                    <TableColumn fx:id="locationColumn" text="Ubicación" prefWidth="180.0"/>
                                    <TableColumn fx:id="actionsColumn" text="Acciones" prefWidth="200.0"/>
                                </columns>
                            </TableView>
                        </VBox>
                        
                        <padding>
                            <Insets top="32.0" bottom="32.0" left="32.0" right="32.0"/>
                        </padding>
                    </VBox>
                </ScrollPane>
            </VBox>
            
            <!-- ============================================
                 VISTA 2: REPORTES
                 ============================================ -->
            <VBox fx:id="vboxAdminReports" spacing="0" visible="false" styleClass="content-area">
                <ScrollPane fitToWidth="true" styleClass="scroll-pane-content" VBox.vgrow="ALWAYS">
                    <VBox spacing="32.0">
                        
                        <!-- Header -->
                        <VBox spacing="16.0">
                            <HBox alignment="CENTER_LEFT" spacing="16.0">
                                <VBox spacing="4.0" HBox.hgrow="ALWAYS">
                                    <Label text="Reportes y Estadísticas" styleClass="text-h2"/>
                                    <Label text="Análisis de uso y ocupación de espacios" styleClass="text-body, text-muted"/>
                                </VBox>
                                <Button text="📥 Exportar Reporte" styleClass="button-primary" 
                                       onAction="#handleExportReport"/>
                            </HBox>
                            
                            <!-- Filtros de Fecha -->
                            <HBox spacing="12.0" alignment="CENTER_LEFT">
                                <Label text="Período:" styleClass="label-bold"/>
                                <DatePicker fx:id="startDatePicker" promptText="Fecha Inicio" 
                                           styleClass="date-picker"/>
                                <Label text="-" styleClass="text-body"/>
                                <DatePicker fx:id="endDatePicker" promptText="Fecha Fin" 
                                           styleClass="date-picker"/>
                                <ComboBox fx:id="reportTypeCombo" promptText="Tipo de Reporte" 
                                         styleClass="combo-box"/>
                                <Button text="Generar" styleClass="button-primary" 
                                       onAction="#handleGenerateReport"/>
                            </HBox>
                        </VBox>
                        
                        <!-- Stats Cards -->
                        <GridPane hgap="24.0" vgap="24.0">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="25.0"/>
                                <ColumnConstraints percentWidth="25.0"/>
                                <ColumnConstraints percentWidth="25.0"/>
                                <ColumnConstraints percentWidth="25.0"/>
                            </columnConstraints>
                            
                            <VBox spacing="8.0" styleClass="stat-card, stat-card-navy" GridPane.columnIndex="0" alignment="CENTER">
                                <Label text="Total Reservas" styleClass="stat-label"/>
                                <Label fx:id="totalBookingsReport" text="145" styleClass="stat-value"/>
                            </VBox>
                            
                            <VBox spacing="8.0" styleClass="stat-card, stat-card-navy" GridPane.columnIndex="1" alignment="CENTER">
                                <Label text="Usuarios Únicos" styleClass="stat-label"/>
                                <Label fx:id="uniqueUsersReport" text="87" styleClass="stat-value"/>
                            </VBox>
                            
                            <VBox spacing="8.0" styleClass="stat-card, stat-card-navy" GridPane.columnIndex="2" alignment="CENTER">
                                <Label text="Ingresos" styleClass="stat-label"/>
                                <Label fx:id="revenueReport" text="₡245K" styleClass="stat-value"/>
                            </VBox>
                            
                            <VBox spacing="8.0" styleClass="stat-card, stat-card-navy" GridPane.columnIndex="3" alignment="CENTER">
                                <Label text="Valoración Promedio" styleClass="stat-label"/>
                                <Label fx:id="avgRatingReport" text="4.5" styleClass="stat-value"/>
                            </VBox>
                        </GridPane>
                        
                        <!-- Gráficos -->
                        <HBox spacing="24.0" VBox.vgrow="ALWAYS">
                            <VBox spacing="16.0" styleClass="card" HBox.hgrow="ALWAYS">
                                <Label text="Reservas por Mes" styleClass="text-h4"/>
                                <VBox fx:id="monthlyChartContainer" styleClass="chart" 
                                     VBox.vgrow="ALWAYS">
                                    <!-- Gráfico dinámico -->
                                </VBox>
                            </VBox>
                            
                            <VBox spacing="16.0" styleClass="card" HBox.hgrow="ALWAYS">
                                <Label text="Espacios Más Usados" styleClass="text-h4"/>
                                <VBox fx:id="topSpacesChartContainer" styleClass="chart" 
                                     VBox.vgrow="ALWAYS">
                                    <!-- Gráfico dinámico -->
                                </VBox>
                            </VBox>
                        </HBox>
                        
                        <!-- Tabla de Reportes -->
                        <VBox spacing="16.0" styleClass="card">
                            <Label text="Detalle de Reservas" styleClass="text-h4"/>
                            
                            <TableView fx:id="reportsTable" styleClass="table-view">
                                <columns>
                                    <TableColumn fx:id="reportDateColumn" text="Fecha" prefWidth="120.0"/>
                                    <TableColumn fx:id="reportSpaceColumn" text="Espacio" prefWidth="180.0"/>
                                    <TableColumn fx:id="reportUserColumn" text="Usuario" prefWidth="150.0"/>
                                    <TableColumn fx:id="reportDurationColumn" text="Duración" prefWidth="100.0"/>
                                    <TableColumn fx:id="reportStatusColumn" text="Estado" prefWidth="100.0"/>
                                    <TableColumn fx:id="reportRevenueColumn" text="Ingreso" prefWidth="100.0"/>
                                </columns>
                            </TableView>
                        </VBox>
                        
                        <padding>
                            <Insets top="32.0" bottom="32.0" left="32.0" right="32.0"/>
                        </padding>
                    </VBox>
                </ScrollPane>
            </VBox>
            
        </StackPane>
    </center>
    
</BorderPane>
